{% extends "base.html" %}

{% block title %}{{ module_name | replace('-', ' ') | title }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">{{ module_name | replace('-', ' ') | title }}</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted">Module loading...</p>
                    
                    <div id="module-content" class="mt-4">
                        <div class="alert alert-info">
                            <h5>Module Information</h5>
                            <p><strong>Module Name:</strong> {{ module_name }}</p>
                            <p><strong>Status:</strong> <span class="badge badge-success">Active</span></p>
                        </div>
                        
                        <h5 class="mt-4">Available API Endpoints</h5>
                        <ul id="endpoints-list" class="list-group">
                            <li class="list-group-item">Loading endpoints...</li>
                        </ul>
                        
                        <div class="mt-4">
                            <button id="health-btn" class="btn btn-sm btn-outline-primary">Check Health</button>
                            <button id="refresh-btn" class="btn btn-sm btn-outline-secondary">Refresh</button>
                            <a href="/dashboard" class="btn btn-sm btn-outline-secondary">Back to Dashboard</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const moduleName = '{{ module_name }}';
    
    // Load module health and endpoints
    loadModuleInfo();
    
    document.getElementById('health-btn').addEventListener('click', checkHealth);
    document.getElementById('refresh-btn').addEventListener('click', loadModuleInfo);
    
    function loadModuleInfo() {
        // Try to fetch module root endpoint
        fetch(`/module/${moduleName}/`)
            .then(r => r.json().catch(() => ({ module: moduleName, status: 'running' })))
            .then(data => {
                console.log('Module info:', data);
                // Populate endpoints
                if (data.endpoints && Array.isArray(data.endpoints)) {
                    const list = document.getElementById('endpoints-list');
                    list.innerHTML = '';
                    data.endpoints.forEach(ep => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.innerHTML = `<code>/module/${moduleName}${ep}</code>`;
                        list.appendChild(li);
                    });
                }
            })
            .catch(err => {
                console.log('Module info fetch error (expected if returning HTML):', err);
                // Try alternate endpoint
                fetch(`/module/${moduleName}/api/health`)
                    .then(r => r.json())
                    .then(data => {
                        document.getElementById('endpoints-list').innerHTML = `
                            <li class="list-group-item">
                                <strong>Health:</strong> <span class="badge badge-success">${data.status || 'ok'}</span>
                            </li>
                            <li class="list-group-item">
                                <strong>Service:</strong> ${data.service || moduleName}
                            </li>
                        `;
                    })
                    .catch(e => console.log('Health check also failed'));
            });
    }
    
    function checkHealth() {
        fetch(`/module/${moduleName}/api/health`)
            .then(r => r.json())
            .then(data => {
                alert(`Health Status:\n${JSON.stringify(data, null, 2)}`);
            })
            .catch(err => alert('Health check failed: ' + err.message));
    }
});
</script>

<style>
.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
code {
    background-color: #f8f9fa;
    padding: 2px 6px;
    border-radius: 3px;
    color: #d63384;
}
</style>
{% endblock %}
